<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GSAT COUNTDOWN • Neon Formula Gallery</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
  <style>
    :root{
      --bg-1:#0a0f1e; --bg-2:#121733; --grid:#ffffff12;
      --line:#00fff7; --line-dim:#00fff744; --accent:#00ffd0; --accent-2:#bfa100;
      --pink:#ff00cc; --lime:#00ff85; --yellow:#fffb00; --text:#e9f1ff; --muted:#a6b3d9;
      --shadow: 0 12px 40px #00fff726, 0 1px 0 #00fff733 inset;
      --r-lg:22px; --r-xl:28px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;min-height:100vh;display:flex;flex-direction:column;align-items:center;
      background:linear-gradient(135deg,var(--bg-1) 0%, var(--bg-2) 55%, #008f43 90%, #0cffef 100%);
      color:var(--text);font-family:ui-sans-serif,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","Noto Sans",Arial;
      overflow:auto;position:relative;user-select:none
    }
    /* custom scrollbar */
    :root{scrollbar-color:#00fff7 #0e1430;scrollbar-width:thin}
    ::-webkit-scrollbar{width:10px}
    ::-webkit-scrollbar-track{background:#0e1430}
    ::-webkit-scrollbar-thumb{background:linear-gradient(180deg,#00fff7,#ff00cc);border-radius:20px}

    /* moving grid + aurora */
    body::before{
      content:"";position:absolute;inset:0;pointer-events:none;z-index:0;
      background:
        radial-gradient(1000px 600px at 20% 10%, #00fff712 0%, transparent 60%),
        radial-gradient(900px 600px at 80% 90%, #ff00cc10 0%, transparent 60%),
        repeating-linear-gradient(to right, var(--grid) 0 1px, transparent 1px 50px),
        repeating-linear-gradient(to bottom, var(--grid) 0 1px, transparent 1px 50px);
      mix-blend-mode: screen;animation:grid-pan 40s linear infinite;
    }
    @keyframes grid-pan{from{background-position:0 0,0 0,0 0,0 0}to{background-position:0 0,0 0,1200px 0,0 800px}}

    .aurora{position:fixed;inset:0;z-index:0;pointer-events:none;opacity:.55;mix-blend-mode:screen;background:
      conic-gradient(from 0deg at 10% 20%, #00fff715, transparent 40%),
      conic-gradient(from 180deg at 90% 80%, #ff00cc15, transparent 40%);
      animation:aur 16s ease-in-out infinite alternate}
    @keyframes aur{to{filter:hue-rotate(60deg) blur(2px)}}

    /* scroll progress bar */
    #scrollbarProgress{position:fixed;left:0;top:0;height:4px;width:0;z-index:5;background:linear-gradient(90deg,#ff00cc,#ffe066,#00fff7)}

    #starfield{position:fixed;inset:0;z-index:0;filter:contrast(1.1) saturate(1.05)}
    #galaxy{position:fixed;inset:0;z-index:0;filter:blur(.3px) saturate(1.25)}

    .wrap{position:relative;z-index:1;display:flex;flex-direction:column;align-items:center;gap:14px;width:min(1200px,94vw);padding:18px 0 48px}

    .brand{margin-top:8px;font-weight:900;letter-spacing:2px;font-size:clamp(22px,3.4vw,40px);
      background:linear-gradient(90deg,var(--pink),#00fff7,var(--yellow),var(--lime),var(--pink));
      background-size:200% auto;-webkit-background-clip:text;background-clip:text;color:transparent;
      filter:drop-shadow(0 0 10px #00fff733);animation:hueflow 6s linear infinite}
    @keyframes hueflow{from{background-position:0 50%}to{background-position:200% 50%}}

    /* ring */
    .ring-wrap{position:relative;display:grid;place-items:center}
    .ring{width:min(520px,80vw);aspect-ratio:1;display:grid;place-items:center;position:relative}
    .ring svg{width:100%;height:100%;filter:drop-shadow(0 0 10px var(--line-dim))}
    .ring-center{position:absolute;inset:12%;border-radius:50%;background:linear-gradient(135deg,#1a1f38,#101323);box-shadow:0 8px 40px #0006 inset, var(--shadow);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;padding:18px;text-align:center}
    .big{font-variant-numeric:tabular-nums;font-weight:800;letter-spacing:2px;font-size:clamp(38px,7.2vw,84px)}
    .units{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
    .flip{width:96px;height:96px;border-radius:var(--r-lg);background:linear-gradient(135deg,#232526,#3a3d59);color:var(--line);display:grid;place-items:center;box-shadow:var(--shadow);font-size:34px;font-weight:800;letter-spacing:2px;font-variant-numeric:tabular-nums;position:relative;overflow:hidden}
    .flip::after{content:"";position:absolute;inset:auto 0 50% 0;height:1px;background:linear-gradient(90deg,#fff2 0,#fff5 30%,#fff2 100%)}
    .flip.flip-anim{animation:flip 600ms ease}
    @keyframes flip{0%{transform:rotateX(0)}49%{transform:rotateX(90deg)}50%{transform:rotateX(-90deg)}100%{transform:rotateX(0)}}

    /* controls */
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
    .btn{border:none;cursor:pointer;border-radius:14px;padding:8px 12px;font-weight:700;color:#04121a;background:#00fff71a;box-shadow:var(--shadow)}
    .btn:hover{background:#00fff72e}

    dialog{border:none;border-radius:16px;background:#0f1426;color:var(--text);padding:14px 16px;box-shadow:0 30px 80px #0008;width:min(560px,92vw)}
    dialog::backdrop{background:#0008}
    .field{display:flex;gap:8px;align-items:center;margin:8px 0}
    input[type="datetime-local"], input[type="number"]{background:#0b1123;color:var(--text);border:1px solid #2a365d;border-radius:10px;padding:8px 10px}

    /* gallery */
    .gallery{width:100%;display:grid;grid-template-columns:repeat( auto-fill, minmax(260px, 1fr) );gap:14px;margin-top:10px}
    .tile{min-height:86px;display:grid;place-items:center;padding:10px;border-radius:20px;background:linear-gradient(135deg,#0f1534,#0a1028);box-shadow:var(--shadow);position:relative;overflow:hidden}
    .tile::before{content:"";position:absolute;inset:-2px;border-radius:22px;padding:2px;background:linear-gradient(90deg,#00fff744,#ff00cc44,#ffe06644,#00fff744);-webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);-webkit-mask-composite:xor;mask-composite:exclude}
    .tile:hover{filter:brightness(1.05)}

    /* scope */
    .scope{position:fixed;inset:auto 24px 24px 24px;height:96px;border-radius:16px;overflow:hidden;opacity:.7;pointer-events:none}
    .scope canvas{width:100%;height:100%}
  </style>
</head>
<body>
  <div id="scrollbarProgress"></div>
  <canvas id="starfield" aria-hidden="true"></canvas>
  <canvas id="galaxy" aria-hidden="true"></canvas>
  <div class="aurora" aria-hidden="true"></div>

  <div class="wrap">
    <div class="brand">GSAT</div>

    <!-- Countdown Ring -->
    <div class="ring-wrap">
      <div class="ring" id="ring">
        <svg viewBox="0 0 100 100" role="img" aria-label="倒數">
          <defs>
            <linearGradient id="g" x1="0" x2="1">
              <stop offset="0%" stop-color="#00fff7" stop-opacity=".9"/>
              <stop offset="100%" stop-color="#ff00cc" stop-opacity=".9"/>
            </linearGradient>
          </defs>
          <circle cx="50" cy="50" r="44" fill="none" stroke="#00fff714" stroke-width="8" />
          <circle id="arc" cx="50" cy="50" r="44" fill="none" stroke="url(#g)" stroke-width="8" stroke-linecap="round" stroke-dasharray="0 999" transform="rotate(-90 50 50)" />
          <circle id="beam" cx="50" cy="6" r="2.2" fill="#ffe066" />
        </svg>
        <div class="ring-center">
          <div class="big" id="D">00</div>
          <div class="units" id="U"></div>
        </div>
      </div>
    </div>

    <div class="toolbar">
      <button class="btn" id="open">設定</button>
    </div>

    <!-- Massive Formula Gallery (scroll to load more) -->
    <section class="gallery" id="gallery"></section>
    <div id="sentinel" style="height:1px"></div>

    <div class="scope"><canvas id="scope"></canvas></div>
  </div>

  <dialog id="dlg">
    <form method="dialog">
      <div class="field">
        <label for="dt">開始：</label>
        <input id="dt" type="datetime-local" />
      </div>
      <div class="field">
        <label for="prep">準備(天)：</label>
        <input id="prep" type="number" min="1" max="365" value="180" />
      </div>
      <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:8px">
        <button class="btn" value="cancel">取消</button>
        <button class="btn" id="save">儲存</button>
      </div>
    </form>
  </dialog>

  <script>
  const $=(q,r=document)=>r.querySelector(q);const $$=(q,r=document)=>[...r.querySelectorAll(q)];
  const pad=n=>n.toString().padStart(2,'0'); const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));

  // KaTeX readiness gate
  const katexReady = new Promise(res=>{ if(window.renderMathInElement){res()} else { window.addEventListener('load', ()=>res(), {once:true}) } });
  function renderLatex(el){ katexReady.then(()=>{ renderMathInElement(el,{delimiters:[{left:'$$',right:'$$',display:true}]}); }); }

  // Scroll progress bar
  const sp=$('#scrollbarProgress');
  addEventListener('scroll',()=>{
    const h=document.documentElement; const p=(h.scrollTop)/(h.scrollHeight-h.clientHeight); sp.style.width=(p*100).toFixed(2)+'%';
  },{passive:true});

  // Storage
  const KEY='gsat.v3';
  const defaults={startISO:'2026-01-16T09:00', prepDays:180};
  let store=JSON.parse(localStorage.getItem(KEY)||'null')||defaults;

  // Countdown
  const arc=$('#arc'), beam=$('#beam'), D=$('#D'), U=$('#U');
  function makeFlip(v){const d=document.createElement('div');d.className='flip';d.innerHTML=`<span>${pad(v)}</span>`; return d}
  function setArc(p){const r=44,C=2*Math.PI*r;const dash=clamp(p,0,1)*C;arc.setAttribute('stroke-dasharray',`${dash} ${C}`);const ang=-90+360*p;const rad=ang*Math.PI/180;beam.setAttribute('cx',(50+r*Math.cos(rad)).toFixed(2));beam.setAttribute('cy',(50+r*Math.sin(rad)).toFixed(2));}
  function diff(ms){const t=Math.max(0,Math.floor(ms/1000));return {d:Math.floor(t/86400),h:Math.floor(t%86400/3600),m:Math.floor(t%3600/60),s:t%60}}
  function tick(){
    const now=new Date(); const start=new Date(store.startISO); const prepStart=new Date(start.getTime()-store.prepDays*86400000);
    const total=start-prepStart; const left=start-now; const p=clamp(1-(start-now)/total,0,1);
    const {d,h,m,s}=diff(left); D.textContent=pad(d); U.replaceChildren(makeFlip(h),makeFlip(m),makeFlip(s)); $$('.flip',U).forEach(el=>{el.classList.remove('flip-anim');void el.offsetWidth;el.classList.add('flip-anim')}); setArc(p);
  }
  setInterval(tick,1000); tick();

  // Settings
  const dlg=$('#dlg'); $('#open').onclick=()=>{ $('#dt').value=store.startISO; $('#prep').value=store.prepDays; dlg.showModal() };
  $('#save').onclick=(e)=>{ e.preventDefault(); const v=$('#dt').value||store.startISO; const p=parseInt($('#prep').value,10)||180; store={startISO:v,prepDays:clamp(p,1,365)}; localStorage.setItem(KEY,JSON.stringify(store)); dlg.close(); tick(); };

  // Background starfield
  (function(){const c=$('#starfield'),x=c.getContext('2d');function sz(){c.width=innerWidth;c.height=innerHeight}sz();addEventListener('resize',sz);
    const n=()=>Math.floor(c.width*c.height/9000);let stars=[];function init(){stars=Array.from({length:n()},()=>({x:Math.random()*c.width,y:Math.random()*c.height,z:Math.random()*2+0.5,r:Math.random()*1.2+0.2,seed:Math.random()*6.28}))}init(); addEventListener('resize',init);
    let mx=innerWidth/2,my=innerHeight/2; addEventListener('mousemove',e=>{mx=e.clientX;my=e.clientY});
    (function draw(){x.clearRect(0,0,c.width,c.height);for(const s of stars){const dx=(s.x-mx)/c.width,dy=(s.y-my)/c.height;const tw=.6+.4*Math.sin(performance.now()/300+s.seed);x.fillStyle=`rgba(255,255,255,${0.6*tw})`;x.beginPath();x.arc(s.x+dx*8*s.z,s.y+dy*8*s.z,s.r*tw,0,6.28);x.fill()}requestAnimationFrame(draw)})()
  })();

  // Galaxy band (Milky Way vibe)
  ;(function(){const c=$('#galaxy'),ctx=c.getContext('2d');function size(){c.width=innerWidth;c.height=innerHeight}size();addEventListener('resize',size);
    const phi=-25*Math.PI/180;const cos=Math.cos(phi),sin=Math.sin(phi);const pts=[];const N=1800;function gauss(){let u=0,v=0;while(u===0)u=Math.random();while(v===0)v=Math.random();return Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*v)}
    function init(){pts.length=0;for(let i=0;i<N;i++){const s=(Math.random()*2-1)*c.width*0.65;const t=gauss()*c.height*0.18;const dx=s*cos - t*sin;const dy=s*sin + t*cos;const x=c.width/2+dx;const y=c.height/2+dy;const r=Math.random()*1.8+0.2;const hue=180+100*Math.random();const alpha=0.05+Math.random()*0.07;const spin=Math.random()*6.28;pts.push({x,y,r,hue,alpha,spin})}}
    init(); addEventListener('resize',init);
    function draw(){ctx.clearRect(0,0,c.width,c.height);const g=ctx.createRadialGradient(c.width*0.35,c.height*0.3,0,c.width*0.35,c.height*0.3,Math.max(c.width,c.height)*0.8);g.addColorStop(0,'rgba(0,255,247,0.05)');g.addColorStop(1,'rgba(0,0,0,0)');ctx.fillStyle=g;ctx.fillRect(0,0,c.width,c.height);for(const p of pts){const a=p.alpha*(0.7+0.3*Math.sin(performance.now()/1200+p.spin));ctx.fillStyle=`hsla(${p.hue},90%,60%,${a})`;ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,6.28);ctx.fill()}requestAnimationFrame(draw)}draw();})();

  // Oscilloscope
  (function(){const c=$('#scope'),x=c.getContext('2d');function S(){c.width=c.clientWidth;c.height=c.clientHeight}S();addEventListener('resize',S);let t=0;(function d(){t+=.02;const w=c.width,h=c.height;x.clearRect(0,0,w,h);x.strokeStyle='#00fff722';x.lineWidth=1;x.beginPath();for(let i=0;i<w;i+=24){x.moveTo(i,0);x.lineTo(i,h)}for(let j=0;j<h;j+=24){x.moveTo(0,j);x.lineTo(w,j)}x.stroke();x.strokeStyle='#00fff7';x.lineWidth=2;x.beginPath();for(let i=0;i<w;i++){const a=Math.sin((i+t*60)*.02)*.6+Math.sin(i*.015+t*2)*.3;const y=h*.5+a*h*.18+Math.sin(t*1.3+i*.02)*2;if(i===0)x.moveTo(i,y);else x.lineTo(i,y)}x.stroke();requestAnimationFrame(d)})()})();

  // Massive formula pool (HS -> Univ)
  const FORMULAS=[
    // Algebra / HS basics
    String.raw`$$ax^2+bx+c=0\;\Rightarrow\;x=\frac{-b\pm\sqrt{b^2-4ac}}{2a}$$`,
    String.raw`$$a^2-b^2=(a-b)(a+b)$$`,
    String.raw`$$\frac{a}{b}=\frac{c}{d}\;\Rightarrow\;ad=bc$$`,
    String.raw`$$\sum_{k=1}^{n}k=\frac{n(n+1)}{2}$$`,
    String.raw`$$\sum_{k=1}^{n}k^2=\frac{n(n+1)(2n+1)}{6}$$`,
    String.raw`$$\sum_{k=1}^{n}k^3=\left(\frac{n(n+1)}{2}\right)^2$$`,
    String.raw`$$S_n=\frac{a_1(1-r^n)}{1-r}\;(r\ne1)$$`,
    String.raw`$$\binom{n}{k}=\frac{n!}{k!(n-k)!}$$`,
    String.raw`$$(a+b)^n=\sum_{k=0}^n\binom{n}{k}a^{n-k}b^k$$`,
    String.raw`$$\text{Heron: }A=\sqrt{s(s-a)(s-b)(s-c)},\; s=\tfrac{a+b+c}{2}$$`,
    String.raw`$$\text{Vieta: }x_1+x_2=-\tfrac{b}{a},\;x_1x_2=\tfrac{c}{a}$$`,

    // Trig
    String.raw`$$\sin^2\theta+\cos^2\theta=1$$`,
    String.raw`$$\sin(\alpha\pm\beta)=\sin\alpha\cos\beta\pm\cos\alpha\sin\beta$$`,
    String.raw`$$\cos(2\theta)=\cos^2\theta-\sin^2\theta=1-2\sin^2\theta=2\cos^2\theta-1$$`,
    String.raw`$$\tan(\alpha\pm\beta)=\frac{\tan\alpha\pm\tan\beta}{1\mp\tan\alpha\tan\beta}$$`,
    String.raw`$$e^{i\theta}=\cos\theta+i\sin\theta$$`,

    // Geometry/Analytic
    String.raw`$$d{=}\sqrt{(x_2-x_1)^2+(y_2-y_1)^2}$$`,
    String.raw`$$(x-x_0)^2+(y-y_0)^2=r^2$$`,
    String.raw`$$\frac{x-x_1}{x_2-x_1}=\frac{y-y_1}{y_2-y_1}$$`,

    // Calculus
    String.raw`$$\lim_{x\to0}\frac{\sin x}{x}=1$$`,
    String.raw`$$\frac{d}{dx}(x^n)=nx^{n-1}$$`,
    String.raw`$$\frac{d}{dx}(\sin x)=\cos x,\;\frac{d}{dx}(\cos x)=-\sin x$$`,
    String.raw`$$\int x^n\,dx=\frac{x^{n+1}}{n+1}+C\;(n\ne-1)$$`,
    String.raw`$$\int e^{ax}\,dx=\frac{e^{ax}}{a}+C$$`,
    String.raw`$$\int\frac{1}{x}\,dx=\ln|x|+C$$`,
    String.raw`$$\text{FTC: }\int_a^b f'(x)\,dx=f(b)-f(a)$$`,
    String.raw`$$\text{Chain: }\frac{dy}{dx}=\frac{dy}{du}\frac{du}{dx}$$`,
    String.raw`$$e^x=\sum_{k=0}^{\infty}\frac{x^k}{k!}$$`,
    String.raw`$$\sin x=\sum_{k=0}^{\infty}(-1)^k\frac{x^{2k+1}}{(2k+1)!}$$`,
    String.raw`$$\cos x=\sum_{k=0}^{\infty}(-1)^k\frac{x^{2k}}{(2k)!}$$`,
    String.raw`$$\ln(1+x)=\sum_{k=1}^{\infty}(-1)^{k+1}\frac{x^k}{k}\;(\lvert x\rvert<1)$$`,
    String.raw`$$\frac{1}{1-x}=\sum_{k=0}^{\infty}x^k\;(\lvert x\rvert<1)$$`,

    // Multivariable + Vector calc
    String.raw`$$\nabla f=\left(\frac{\partial f}{\partial x},\frac{\partial f}{\partial y},\frac{\partial f}{\partial z}\right)$$`,
    String.raw`$$\nabla\cdot\mathbf{F}=\frac{\partial F_x}{\partial x}+\frac{\partial F_y}{\partial y}+\frac{\partial F_z}{\partial z}$$`,
    String.raw`$$\nabla\times\mathbf{F}=\begin{vmatrix}\mathbf{i}&\mathbf{j}&\mathbf{k}\\\partial_x&\partial_y&\partial_z\\F_x&F_y&F_z\end{vmatrix}$$`,
    String.raw`$$\iint_S (\nabla\times\mathbf{F})\cdot d\mathbf{S}=\oint_{\partial S}\!\mathbf{F}\cdot d\boldsymbol{\ell}\;(\text{Stokes})$$`,
    String.raw`$$\iiint_V (\nabla\cdot\mathbf{F})\,dV=\oiint_{\partial V}\!\mathbf{F}\cdot d\mathbf{S}\;(\text{Gauss})$$`,

    // Linear Algebra
    String.raw`$$\det(A-\lambda I)=0$$`,
    String.raw`$$A\mathbf{v}=\lambda\mathbf{v}$$`,
    String.raw`$$A=Q\Lambda Q^{\!T}\;(A\text{ 實對稱})$$`,
    String.raw`$$A=U\Sigma V^{\!T}\;(\text{SVD})$$`,
    String.raw`$$\text{rank}(A)+\text{nullity}(A)=n$$`,
    String.raw`$$\mathbf{P}=X(X^{\!T}X)^{-1}X^{\!T}$$`,
    String.raw`$$\hat{\beta}=(X^{\!T}X)^{-1}X^{\!T}y$$`,
    String.raw`$$A^n-\operatorname{tr}(A)A^{n-1}+\cdots+(-1)^n\det(A)I=0\;(\text{Cayley–Hamilton})$$`,

    // Probability & Stats
    String.raw`$$P(A\mid B)=\frac{P(B\mid A)P(A)}{P(B)}$$`,
    String.raw`$$\mathbb{E}[aX+b]=a\,\mathbb{E}[X]+b$$`,
    String.raw`$$\operatorname{Var}(X)=\mathbb{E}[X^2]-\mathbb{E}[X]^2$$`,
    String.raw`$$\operatorname{Cov}(X,Y)=\mathbb{E}[XY]-\mathbb{E}[X]\,\mathbb{E}[Y]$$`,
    String.raw`$$\phi_X(t)=\mathbb{E}[e^{itX}]$$`,
    String.raw`$$f_{\mathcal{N}}(x)=\frac{1}{\sqrt{2\pi\sigma^2}}\exp\!\left(-\frac{(x-\mu)^2}{2\sigma^2}\right)$$`,
    String.raw`$$\mathrm{KL}(P\parallel Q)=\sum_x P(x)\log\frac{P(x)}{Q(x)}$$`,
    String.raw`$$\Pr\{\lvert X-\mu\rvert\ge k\sigma\}\le \frac{1}{k^2}\;(\text{Chebyshev})$$`,
    String.raw`$$\frac{\overline{X}-\mu}{S/\sqrt{n}}\sim t_{n-1}$$`,
    String.raw`$$\text{LLN: }\overline{X}_n\xrightarrow{p}\mu,\;\text{CLT: }\frac{\overline{X}_n-\mu}{\sigma/\sqrt{n}}\Rightarrow\mathcal{N}(0,1)$$`,

    // ODE / PDE / Transforms
    String.raw`$$y'+p(x)y=q(x)\;\Rightarrow\;y=\mu^{-1}\!\left(\int \mu q\,dx+C\right),\;\mu=e^{\int p\,dx}$$`,
    String.raw`$$y''+ay'+by=0\Rightarrow r^2+ar+b=0$$`,
    String.raw`$$\mathcal{L}\{f\}(s)=\int_0^{\infty} e^{-st}f(t)\,dt$$`,
    String.raw`$$\mathcal{F}\{f\}(\omega)=\int_{-\infty}^{\infty} f(t)e^{-i\omega t}\,dt$$`,
    String.raw`$$u_t=\alpha u_{xx}\;(\text{Heat})$$`,
    String.raw`$$u_{tt}=c^2 u_{xx}\;(\text{Wave})$$`,
    String.raw`$$\nabla^2 u=0\;(\text{Laplace})$$`,
    String.raw`$$f(x)=\frac{a_0}{2}+\sum_{n=1}^{\infty}\left[a_n\cos\frac{n\pi x}{L}+b_n\sin\frac{n\pi x}{L}\right]$$`,

    // EM / Optics / Circuits
    String.raw`$$\nabla\cdot\mathbf{E}=\frac{\rho}{\varepsilon_0},\;\nabla\cdot\mathbf{B}=0,\;\nabla\times\mathbf{E}=-\partial_t\mathbf{B},\;\nabla\times\mathbf{B}=\mu_0\mathbf{J}+\mu_0\varepsilon_0\partial_t\mathbf{E}$$`,
    String.raw`$$\mathbf{E}(\mathbf{r})=\frac{1}{4\pi\varepsilon_0}\int \frac{\rho(\mathbf{r'})}{\lvert\mathbf{r}-\mathbf{r'}\rvert^2}\hat{\mathbf{R}}\,d^3r'$$`,
    String.raw`$$V=IR$$`,
    String.raw`$$Z_{R}=R,\;Z_{L}=i\omega L,\;Z_{C}=\frac{1}{i\omega C}$$`,
    String.raw`$$d\,\sin\theta=m\lambda$$`,
    String.raw`$$n_1\sin\theta_1=n_2\sin\theta_2$$`,

    // Mechanics / Relativity / Thermo / QM
    String.raw`$$F=ma,\;p=mv,\;E_k=\tfrac12 mv^2$$`,
    String.raw`$$W=\int \mathbf{F}\cdot d\mathbf{r}$$`,
    String.raw`$$\mathbf{L}=\mathbf{r}\times\mathbf{p}$$`,
    String.raw`$$U(r)=-\frac{GMm}{r}$$`,
    String.raw`$$T^2\propto a^3\;(\text{Kepler})$$`,
    String.raw`$$E=\gamma mc^2,\;\gamma=\frac{1}{\sqrt{1-v^2/c^2}}$$`,
    String.raw`$$\Delta t'=\gamma\,\Delta t,\;L'=\frac{L}{\gamma}$$`,
    String.raw`$$PV=nRT$$`,
    String.raw`$$\eta_{\text{Carnot}}=1-\frac{T_c}{T_h}$$`,
    String.raw`$$i\hbar\partial_t\Psi=\left(-\frac{\hbar^2}{2m}\nabla^2+V\right)\Psi$$`,
    String.raw`$$[\hat{x},\hat{p}]=i\hbar$$`,
    String.raw`$$\langle A\rangle=\int \Psi^*\hat{A}\,\Psi\,d\tau$$`,
    String.raw`$$E_n=-\frac{13.6\,\text{eV}}{n^2}$$`,

    // Complex / Analysis
    String.raw`$$\oint_C f(z)\,dz=2\pi i\sum \operatorname{Res}(f)$$`,
    String.raw`$$f^{(n)}(a)=\frac{n!}{2\pi i}\oint \frac{f(z)}{(z-a)^{n+1}}dz$$`,
    String.raw`$$\int_{-\infty}^{\infty} e^{-x^2}\,dx=\sqrt{\pi}$$`,
    String.raw`$$\text{Cauchy–Schwarz: }|\langle x,y\rangle|\le \lVert x\rVert\,\lVert y\rVert$$`,
    String.raw`$$\text{Jensen: }\varphi(\mathbb{E}[X])\le \mathbb{E}[\varphi(X)]\;(\varphi\text{ convex})$$`,
    String.raw`$$\Gamma(z)=\int_0^{\infty} t^{z-1}e^{-t}\,dt$$`,
  ];

  // Expand with families (generate more)
  (function extend(){
    const extra=[];
    // Derivatives of common functions
    const fns=[["e^{ax}","a e^{ax}"],["\\ln x","1/x"],["\\tan x","\\sec^2 x"],["\\sec x","\\sec x\\tan x"],["\\arcsin x","1/\\sqrt{1-x^2}"],["\\arctan x","1/(1+x^2)"]];
    fns.forEach(([f,df])=>extra.push(String.raw`$$\\frac{d}{dx}(${f})=${df}$$`));
    // Integrals
    const ints=[["\\sin ax","-\\frac{\\cos ax}{a}"],["\\cos ax","\\frac{\\sin ax}{a}"],["e^{ax}\\sin bx","\\frac{e^{ax}(a\\sin bx-b\\cos bx)}{a^2+b^2}"],["e^{ax}\\cos bx","\\frac{e^{ax}(a\\cos bx+b\\sin bx)}{a^2+b^2}"]];
    ints.forEach(([g,G])=>extra.push(String.raw`$$\\int ${g}\\,dx=${G}+C$$`));
    // Angle addition multiples
    [2,3,4].forEach(n=>extra.push(String.raw`$$\\sin(${n}\\theta)=\\Im\\{(\\cos\\theta+i\\sin\\theta)^{${n}}\\}$$`));
    // Fourier/Laplace pairs
    extra.push(String.raw`$$\\mathcal{F}\\{\\operatorname{rect}(t/T)\\}=T\\,\\operatorname{sinc}\\!\\left(\\tfrac{\\omega T}{2}\\right)$$`);
    extra.push(String.raw`$$\\mathcal{L}\\{\\sin bt\\}=\\frac{b}{s^2+b^2}$$`);
    // Probability families
    extra.push(String.raw`$$\\text{Bin}(k;n,p)=\\binom{n}{k}p^k(1-p)^{n-k}$$`);
    extra.push(String.raw`$$\\text{Pois}(k;\\lambda)=e^{-\\lambda}\\frac{\\lambda^k}{k!}$$`);
    // PDE solutions sketch
    extra.push(String.raw`$$u(x,t)=\\sum_{n=1}^\\infty b_n\\sin\\tfrac{n\\pi x}{L}\\,e^{-\\alpha (n\\pi/L)^2 t}$$`);
    // Linear algebra families
    extra.push(String.raw`$$\\|Ax\\|_2\\le \\|A\\|_2\\,\\|x\\|_2$$`);
    extra.push(String.raw`$$\\det(AB)=\\det A\\,\\det B$$`);
    FORMULAS.push(...extra);
  })();

  // Gallery infinite load
  const host=$('#gallery'); let idx=0; const STEP=24;
  function addMore(n=STEP){
    const end=Math.min(idx+n, FORMULAS.length);
    for(;idx<end;idx++){
      const t=document.createElement('div');
      t.className='tile';
      t.innerHTML=FORMULAS[idx];
      host.appendChild(t);
      renderLatex(t);
    }
    if(idx>=FORMULAS.length){idx=0}
  }
  addMore(36);
  const io=new IntersectionObserver(es=>{es.forEach(e=>{if(e.isIntersecting)addMore()})}); io.observe($('#sentinel'));
  setInterval(()=>addMore(8), 5000);
  </script>
</body>
</html>
